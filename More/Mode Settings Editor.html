<!doctypehtml><html lang="en"><meta http-equiv="Content-Type"content="text/html; charset=UTF-8"><title>Tweaks Mode Settings Editor</title><link rel="stylesheet"href="../HTML/css/font.css"><style>body{background:#d3d3d3;font-family:"Trebuchet MS";margin:0}#editor{margin-bottom:9.36px}.fullscreen-msg{display:flex;justify-content:center;position:fixed;left:0;bottom:0;right:0;top:0;transition:background .25s,color .25s;pointer-events:none;color:transparent}.fullscreen-msg.hovering{background:rgba(127,127,127,.5);color:#fff}.fullscreen-msg span{align-self:center;font-size:500%}label{pointer-events:all;cursor:pointer}div.title-container{background:#fff;margin-bottom:8px;margin:6px;padding:8px;min-width:317px}div.title{text-align:center;font-size:150%;padding-bottom:10px;border-bottom:gray 1px dashed}div.header{display:flex;justify-content:space-around;font-size:125%;padding-top:10px}div.sections{padding-left:8px}h3.section{margin:0;margin-top:9.36px;padding-left:2px;color:#646464}h3.section u{cursor:pointer}h3.section.visible{padding-left:0}div.toggleMods{color:#646464;font-size:75%;margin-left:30px}div.mods{display:flex;flex-wrap:wrap;padding:3px;padding-left:0}.mod{display:flex;align-items:center;background:#fff;padding:6px;margin:3px;transition:background .4s,border-color .4s;flex-grow:1;align-content:center;color:#000;text-decoration:none;border:2px dashed #fff}.mod.noValue{border-color:#c81919;cursor:help}.mod.differentValue{border-color:#1919c8;cursor:help}.mod-id{color:#757575;font-style:italic;font-size:60%}img.mod-icon{float:left;margin-right:10px;height:32px;width:32px;object-fit:none}div.mod-info{float:right}input[type=number]{margin-left:15px;width:4em;flex-grow:1}input[type=file]{display:none}input{font-family:inherit}.external-score{color:#6e6e6e;margin-left:3px;transition:color .4s;cursor:help}.external-score-positive{color:#198219}.external-score-negative{color:#c81919}button{color:inherit;border:inherit;font:inherit;text-align:inherit;background:inherit;padding:0}.clickable{font-size:inherit;color:#00e;cursor:pointer;text-decoration:underline}</style><script src="js/vue.min.js"></script><script src="js/vue-toastr-2.min.js"></script><link rel="stylesheet"href="css/vue-toastr-2.min.css"><script>const sortingMethods=[{Name:"Name",Compare:(e,o)=>e.SortKey>o.SortKey?1:-1},{Name:"Value",Compare:(e,o)=>{if(!vueData.perModule){var t=void 0===e.defaultValue(vueData.perModule),n=void 0===o.defaultValue(vueData.perModule);if(t&&!n)return-1;if(!t&&n)return 1}return vueData.perModule?-(e.currentValue(vueData.perModule)-o.currentValue(vueData.perModule)):e.currentValue(vueData.perModule)-o.currentValue(vueData.perModule)}},{Name:"Publish Date",Compare:(e,o)=>e.Published<o.Published?1:-1}],vueData={settings:{TimeModeStartingTime:5,TimeModeStartingMultiplier:9,TimeModeMaxMultiplier:10,TimeModeMinMultiplier:1,TimeModeSolveBonus:.1,TimeModeMultiplierStrikePenalty:1.5,TimeModeTimerStrikePenalty:.25,TimeModeMinimumTimeLost:15,TimeModeMinimumTimeGained:20,ZenModeTimePenalty:0,ZenModeTimePenaltyIncrease:0,ZenModeTimerSpeedUp:.25,ZenModeTimerMaxSpeed:2,SteadyModeFixedPenalty:2,SteadyModePercentPenalty:0,ComponentValues:{},TotalModulesMultiplier:{}},mods:[],modTypes:{Regular:"Solvable Modules",Needy:"Needy Modules"},settingTypes:{ZenMode:"Zen Mode",SteadyMode:"Steady Mode",TimeMode:"Time Mode"},visibleTypes:{ZenMode:!0,SteadyMode:!0,TimeMode:!0,Regular:!0,Needy:!1},isHovering:!1,sortingMethodIndex:0,sortingMethods:sortingMethods,perModule:!1};class Mod{constructor(e,o,t,n,r,a="1970-1-1",i,s){this.Name=e,this.SortKey=o,this.Icon=t,this.ID=n,this.Type=r,this.Published=a,this.Value=void 0,this.DefaultValue=i,this.PerModuleValue=void 0,this.DefaultPerModuleValue=s}defaultValue(e){return e?this.DefaultPerModuleValue:this.DefaultValue}value(e){return e?this.PerModuleValue:this.Value}currentValue(e){return this.value(e)||this.defaultValue(e)||(e?0:10)}}function makeRequest(e){return new Promise((function(o,t){const n=new XMLHttpRequest;n.open("GET",e),n.onload=function(){o(n.responseText)},n.onerror=function(){t(n.status)},n.send()}))}vueData.mods=[],makeRequest("https://ktane.timwi.de/json/raw").then((async e=>{const o=JSON.parse(e);for(const e of vueData.mods){const t=e.Icon;if(0!==t.X||0!==t.Y)continue;const n=e.Name.replace(/ \((Translated|Russian|Polish)\)$/,""),r=o.KtaneModules.filter((e=>e.Name==n));if(1===r.length){const e=r[0];t.X=e.X,t.Y=e.Y}}let t={},n={};try{const e=JSON.parse(await makeRequest("https://spreadsheets.google.com/feeds/list/16lz2mCqRWxq__qnamgvlD0XwTuva4jIDW1VPWX49hzM/1/public/values?alt=json"));for(const o of e.feed.entry)""!=o.gsx$score.$t&&(t[o.gsx$moduleid.$t]=parseFloat(o.gsx$score.$t)),""!=o.gsx$bossmodulepointspermodule.$t&&(n[o.gsx$moduleid.$t]=parseFloat(o.gsx$bossmodulepointspermodule.$t))}catch(e){console.error(e)}for(const e of vueData.mods)t.hasOwnProperty(e.ID)&&(e.DefaultValue=t[e.ID]),n.hasOwnProperty(e.ID)&&(e.DefaultPerModuleValue=n[e.ID]);o.KtaneModules.forEach((function(e){e.ModuleID?vueData.mods.push(new Mod(e.Name,e.SortKey,{X:e.X,Y:e.Y},e.ModuleID,e.Type,e.Published,t[e.ModuleID],n[e.ModuleID])):console.warn("Skipping "+e.Name+" because it lacks an ID.")}))})).catch((e=>console.error(`Failed to load JSON data! Error: ${e}`)));const devMode="file:"==window.location.protocol;Vue.config.devtools=devMode,window.onload=function(){var e=this.toastr;let o=new Vue({el:"#editor",data:vueData,methods:{getJSON:function(){const e={};for(const o in this.settings)e[o]=this.settings[o];e.ComponentValues={};for(const o of this.mods)e.ComponentValues[o.ID]=o.Value;e.TotalModulesMultiplier={};for(const o of this.mods)e.TotalModulesMultiplier[o.ID]=o.PerModuleValue;return JSON.stringify(e,null,2)},onFileUploaded:function(e){r(e.target.files)},fallbackDownload:function(e){navigator.msSaveBlob&&(navigator.msSaveBlob(new Blob([this.getJSON()]),"ModeSettings.json"),e.preventDefault())},getMods:function(e){var o=this.mods.filter((o=>o.Type==e));const t=sortingMethods[this.sortingMethodIndex].Compare;return o.sort(((e,o)=>{const n=t(e,o);return 0!=n?n:sortingMethods[0].Compare(e,o)})),o},toggleType:function(e){Vue.set(this.visibleTypes,e,!this.visibleTypes[e])}},watch:{perModule:function(){o.$emit("inputs")}}});function t(t,n){var r=function(e){try{return JSON.parse(e)}catch(e){return!1}}(t);if(!r)return e.error("Only valid JSON settings are allowed","File Error"),!1;if("ModeSettings.json"==n)for(var a in r)o.settings[a]=r[a];else{if("ModuleInformation.json"!=n)return e.error("Invalid file name","File Error"),!1;{if("object"!=typeof r)return e.error("Invalid ModInfo file","Format Error"),!1;const t={ButtonComponentSolver:"BigButton",KeypadComponentSolver:"Keypad",InvisibleWallsComponentSolver:"Maze",MemoryComponentSolver:"Memory",MorseCodeComponentSolver:"Morse",NeedyDischargeComponentSolver:"NeedyCapacitor",NeedyKnobComponentSolver:"NeedyKnob",NeedyVentComponentSolver:"NeedyVentGas",PasswordComponentSolver:"Password",SimonComponentSolver:"Simon",VennWireComponentSolver:"Venn",WhosOnFirstComponentSolver:"WhosOnFirst",WireSetComponentSolver:"Wires",WireSequenceComponentSolver:"WireSequence"};o.settings.ComponentValues=r.reduce(((e,o)=>(e[t[o.moduleID]||o.moduleID]=o.moduleScore,e)),{})}}for(const e of o.mods)e.Value=void 0;for(var i in o.settings.ComponentValues){const e=o.mods.find((e=>e.ID==i));e?e.Value=o.settings.ComponentValues[i]:(o.mods.push(new Mod(i,i.toUpperCase(),{X:0,Y:0},i,"Regular",o.settings.ComponentValues[i])),console.warn("Can't find mod for "+i))}}function n(o){if(o.match(/^https?:\/\//)){let n=o.match(/[^/]+\.json$/);if(n)return makeRequest((devMode?"https://ktane.timwi.de":"")+"/proxy/"+o).then((function(e){t(e,n[0])})).catch((function(o){e.error("Unable to load settings from URL","HTTP Error"),console.error("HTTP Failure: "+o)})),!0}return!1}function r(n){if(1==n.length){var r=new FileReader;r.onload=function(){t(r.result,n[0].name)},r.readAsText(n[0])}else n.length>1?e.error("You can only import 1 file at a time","File Import Error"):e.error("Unable to find any imported files","File Import Error");o.isHovering=!1}window.addEventListener("dragover",(function(e){o.isHovering=!0,e.preventDefault()})),window.addEventListener("dragleave",(function(){o.isHovering=!1})),window.addEventListener("drop",(function(t){var a=t.dataTransfer.getData("Text");a?(o.isHovering=!1,n(a)||e.warning("Unable to read URL for settings.")):r(t.dataTransfer.files),t.preventDefault()})),window.addEventListener("paste",(function(o){var t="";window.clipboardData?t=window.clipboardData.getData("Text"):"object"==typeof o&&o.clipboardData&&(t=o.clipboardData.getData("text/plain")),n(t)||e.warning("Unable to read URL from paste.")})),Vue.component("module",{props:["mod"],render:function(e){const t=this.mod,n=t.value(o.perModule),r=t.defaultValue(o.perModule);return o.$on("inputs",(()=>{let e=o.perModule?t.PerModuleValue:t.Value;this.$el.getElementsByTagName("input")[0].value=null==e?"":e})),e("div",{class:{mod:!0,noValue:void 0===r,differentValue:void 0!==n&&n!==r},attrs:{title:void 0===n?"No score is assigned to this module, TP or the default will be used instead.":void 0!==n&&n!==r?"This score is different from the default value.":void 0}},[e("img",{class:"mod-icon",attrs:{src:"https://ktane.timwi.de/iconsprite",alt:t.Name+" Icon"},style:{"object-position":`${-32*t.Icon.X}px ${-32*t.Icon.Y}px`}}),e("div",{class:"mod-info"},[e("div",t.Name),e("div",{class:"mod-id"},t.ID)]),e("input",{class:"mod-icon",on:{change:function(e){const n=parseInt(e.target.value);o.perModule?t.PerModuleValue=isNaN(n)?void 0:n:t.Value=isNaN(n)?void 0:n}},attrs:{type:"number",step:"any",value:n,placeholder:r||(o.perModule?0:10),"aria-label":"Module value"}}),e("external-score",{class:"mod-icon",attrs:{mod:t}})])}}),Vue.component("external-score",{props:["mod"],render:function(e){const t=this.mod,n=t.value(o.perModule),r=t.defaultValue(o.perModule),a=(void 0!==n?n:r)-r;let i="?",s="There is no score defined by default.";return null!=r&&(i=(0==a?"":a>0?"+":"-")+Math.abs(a),s=0==a?"Your score is the same as the default.":`Your score is ${Math.abs(a)} ${a>0?"higher":"lower"} than the default.`),e("div",{class:{"external-score":!0,"external-score-positive":a>0,"external-score-negative":a<0},attrs:{title:s}},[`(${i})`])}})}</script><div id="editor"><input id="file-upload"type="file"@change="onFileUploaded"><div class="fullscreen-msg":class="{ hovering: isHovering }"for="file-upload"><span>Drop settings!</span></div><div class="title-container"><div class="title">Mode Settings Editor</div><div class="header"><label class="clickable"for="file-upload"accesskey="i">Import</label><div>Sort By: <button class="clickable"@click="sortingMethodIndex++; sortingMethodIndex %= sortingMethods.length;"accesskey="s"type="button">{{ sortingMethods[sortingMethodIndex].Name }}</button></div><div>Edit: <button class="clickable"@click="perModule = !perModule"accesskey="e"type="button">{{ perModule ? "Per Module" : "Base" }} Value</button></div><div><a @click="fallbackDownload"download="ModeSettings.json":href="'data:application/json,' + encodeURIComponent(getJSON())"accesskey="d">Download</a></div></div></div><div class="sections"><template v-for="(name, type) in settingTypes"><h3 class="section":class="{ visible: visibleTypes[type] }">{{ (visibleTypes[type] ? "▼ " : "▶ ") }}<button @click="toggleType(type)"type="button"><u>{{ name }}</u></button></h3><div v-if="visibleTypes[type]"class="mods"><div class="mod"v-for="(value, field) in settings"v-if="field.startsWith(type)"><span>{{ field.replace(/^(Time|Zen|Steady)Mode/, "").replace(/([A-Z])/g, " $1") }}</span> <input type="number":required="true"step="any"v-model:value="settings[field]"aria-label="Setting value"></div></div></template><template v-for="(name, type) in modTypes"><h3 class="section":class="{ visible: visibleTypes[type] }">{{ (visibleTypes[type] ? "▼ " : "▶ ") }}<button @click="toggleType(type)"type="button"><u>{{ name }}</u></button></h3><div class="mods"v-if="visibleTypes[type]"><module v-for="mod in getMods(type)":mod="mod":key="mod.id"></module></div></template></div></div>